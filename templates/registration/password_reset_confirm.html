{% extends 'base.html' %}
{% block title %}Set New Password - WestLinks Exchange{% endblock %}
{% block content %}
<section class="cvp-container"
    style="margin-top: 4rem; margin-bottom: 4rem; min-height: 60vh; display: flex; align-items: center; justify-content: center;">
    <div class="glass-card" style="max-width: 450px; width: 100%;">
        <div class="text-center mb-4">
            <h1 style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem;">Set New Password</h1>
            <p class="text-secondary">Enter your new password below</p>
        </div>

        <form method="post" style="display: grid; gap: 1.5rem;">
            {% csrf_token %}
            {% if form.non_field_errors %}
            <div
                style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 0.75rem; color: #ef4444; font-size: 0.875rem;">
                {% for error in form.non_field_errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}

            {% for field in form %}
            <div style="position: relative;">
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                <div style="position: relative;">
                    <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}"
                        id="{{ field.id_for_label }}" class="field" required style="padding-right: 44px;">
                    <button type="button" onclick="togglePassword('{{ field.id_for_label }}')"
                        style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer; transition: color 0.3s;">
                        <i data-lucide="eye" style="width: 20px; height: 20px;"></i>
                    </button>
                </div>
                {% if field.help_text %}
                <small class="text-secondary" style="display: block; margin-top: 0.25rem;">{{ field.help_text }}</small>
                {% endif %}
                {% for error in field.errors %}
                <div style="color: #ef4444; font-size: 0.875rem; margin-top: 0.25rem;">{{ error }}</div>
                {% endfor %}
            </div>
            {% endfor %}

            <button type="submit" class="btn btn-primary" style="width: 100%;">Change Password</button>
        </form>
    </div>
</section>

<script>
    function togglePassword(id) {
        const input = document.getElementById(id);
        const icon = input.nextElementSibling.querySelector('i');

        if (input.type === 'password') {
            input.type = 'text';
            // Optional: Change icon if you had an eye-off icon
        } else {
            input.type = 'password';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        if (window.lucide && lucide.createIcons) lucide.createIcons();
    });
</script>
{% endblock %}