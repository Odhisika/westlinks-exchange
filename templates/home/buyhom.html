{% extends "base.html" %}
{% load static %}

{% block title %}Buy Crypto - CoinVibe Pay{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="cvp-container">
        <div class="hero-grid">
            <div class="hero-content" style="text-align: left;">
                <div class="hero-badge">
                    <i data-lucide="zap"></i>
                    Fast & Secure
                </div>
                <h1 class="hero-title">Buy Bitcoin and Perfect Money with Ghana Cedis</h1>
                <p class="hero-subtitle">
                    Get cryptocurrency in minutes with mobile money payments. Simple, secure, and built for Ghanaians.
                </p>
                <div class="hero-cta">
                    <button onclick="handleBuyNow()" class="btn btn-primary btn-lg">
                        <i data-lucide="shopping-cart"></i>
                        Buy Now
                    </button>
                    <a href="/about" class="btn btn-secondary btn-lg">
                        <i data-lucide="info"></i>
                        Learn More
                    </a>
                </div>

                <!-- Trust Indicators -->
                <div class="trust-indicators" style="margin-top: 2rem;">
                    <div class="trust-item">
                        <div class="trust-icon">
                            <i data-lucide="shield-check"></i>
                        </div>
                        <div>
                            <div class="trust-value">100%</div>
                            <div class="trust-label">Secure</div>
                        </div>
                    </div>
                    <div class="trust-item">
                        <div class="trust-icon">
                            <i data-lucide="clock"></i>
                        </div>
                        <div>
                            <div class="trust-value">5 min</div>
                            <div class="trust-label">Average Time</div>
                        </div>
                    </div>
                    <div class="trust-item">
                        <div class="trust-icon">
                            <i data-lucide="users"></i>
                        </div>
                        <div>
                            <div class="trust-value">1000+</div>
                            <div class="trust-label">Happy Users</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hero Card -->
            <div class="hero-rates-card">
                <div class="rates-header">
                    <h3>Current Buy Rate</h3>
                    <div class="live-indicator">
                        <span class="pulse-dot"></span>
                        Live
                    </div>
                </div>

                <div class="rate-item" style="background: var(--bg-card); border: none; margin-bottom: 1.5rem;">
                    <div class="rate-label">
                        <i data-lucide="trending-up"></i>
                        1 USDT
                    </div>
                    <div class="rate-value text-yellow" id="heroBuyRate">₵--</div>
                    <div class="rate-sub">Ghana Cedis</div>
                </div>

                <div class="wallet-info">
                    <div class="wallet-label">
                        <i data-lucide="info"></i>
                        Quick Calculation
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                        <div>
                            <div class="text-muted" style="font-size: 0.75rem; margin-bottom: 0.5rem;">You Pay</div>
                            <div class="text-primary" style="font-size: 1.25rem; font-weight: 700;">₵500</div>
                        </div>
                        <div>
                            <div class="text-muted" style="font-size: 0.75rem; margin-bottom: 0.5rem;">You Get</div>
                            <div class="text-green" style="font-size: 1.25rem; font-weight: 700;" id="heroQuickCalc">--
                                USDT</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- How It Works Section -->
<section class="how-it-works">
    <div class="cvp-container">
        <div class="section-header">
            <h2>How to Buy Crypto in 3 Easy Steps</h2>
            <p>Start buying cryptocurrency in minutes. No complicated setup required.</p>
        </div>

        <div class="steps-grid">
            <div class="step-card">
                <div class="step-number">1</div>
                <div class="step-icon">
                    <i data-lucide="user-plus"></i>
                </div>
                <h3>Create Account</h3>
                <p>Sign up with your email and verify your account. It takes less than a minute to get started.</p>
            </div>

            <div class="step-card">
                <div class="step-number">2</div>
                <div class="step-icon">
                    <i data-lucide="wallet"></i>
                </div>
                <h3>Enter Amount & Wallet</h3>
                <p>Choose how much you want to buy and provide your crypto wallet address for delivery.</p>
            </div>

            <div class="step-card">
                <div class="step-number">3</div>
                <div class="step-icon">
                    <i data-lucide="smartphone"></i>
                </div>
                <h3>Pay with Mobile Money</h3>
                <p>Complete payment using MTN, AirtelTigo, or Vodafone Cash. Receive your crypto instantly!</p>
            </div>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="features-section">
    <div class="cvp-container">
        <div class="section-header">
            <h2>Why Buy Crypto with CoinVibe Pay?</h2>
            <p>The most trusted P2P platform in Ghana</p>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--highlight-green), #2dd4a0);">
                    <i data-lucide="zap"></i>
                </div>
                <h3>Instant Delivery</h3>
                <p>Receive your cryptocurrency within 5 minutes of payment confirmation. No waiting, no delays.</p>
                <ul class="feature-list">
                    <li><i data-lucide="check"></i> Automated processing</li>
                    <li><i data-lucide="check"></i> Real-time notifications</li>
                    <li><i data-lucide="check"></i> Fast blockchain confirmations</li>
                </ul>
            </div>

            <div class="feature-card">
                <div class="feature-icon"
                    style="background: linear-gradient(135deg, var(--highlight-yellow), #f5c842);">
                    <i data-lucide="shield-check"></i>
                </div>
                <h3>Secure Transactions</h3>
                <p>Bank-level security protects every transaction. Your funds and data are always safe.</p>
                <ul class="feature-list">
                    <li><i data-lucide="check"></i> End-to-end encryption</li>
                    <li><i data-lucide="check"></i> Secure wallet integration</li>
                    <li><i data-lucide="check"></i> PCI-DSS compliant</li>
                </ul>
            </div>

            <div class="feature-card">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--highlight-cyan), #00d4ff);">
                    <i data-lucide="headphones"></i>
                </div>
                <h3>24/7 Support</h3>
                <p>Our customer support team is always ready to help you with any questions or issues.</p>
                <ul class="feature-list">
                    <li><i data-lucide="check"></i> Live chat support</li>
                    <li><i data-lucide="check"></i> Email assistance</li>
                    <li><i data-lucide="check"></i> Comprehensive FAQ</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="cvp-container">
        <div class="cta-content">
            <h2>Ready to Buy Cryptocurrency?</h2>
            <p>Join thousands of Ghanaians already using CoinVibe Pay to access the world of digital finance.</p>
            <div class="cta-buttons">
                <button onclick="handleBuyNow()" class="btn btn-primary btn-lg">
                    <i data-lucide="rocket"></i>
                    Start Buying Now
                </button>
                <a href="/about" class="btn btn-secondary btn-lg">
                    <i data-lucide="help-circle"></i>
                    Have Questions?
                </a>
            </div>
        </div>
    </div>
</section>

<script>
    // Load and display current buy rate
    async function loadBuyRate() {
        try {
            const res = await fetch(`${API_URL}/public/settings`);
            const data = await res.json();
            if (data.success && data.settings) {
                const buyRate = Number(data.settings.buy_rate) || 15.20;
                document.getElementById('heroBuyRate').textContent = `₵${buyRate.toFixed(2)}`;

                // Calculate quick preview (500 GHS)
                const usdtAmount = 500 / buyRate;
                document.getElementById('heroQuickCalc').textContent = `${usdtAmount.toFixed(2)} USDT`;
            }
        } catch (e) {
            console.error('Failed to load buy rate:', e);
        }
    }

    // Handle Buy Now button click
    function handleBuyNow() {
        const token = localStorage.getItem('coinvibe_token');
        const loggedIn = !!(token && token !== 'null' && token !== 'undefined' && token !== '');

        if (loggedIn) {
            // User is logged in, go to actual buy page
            window.location.href = '/buy';
        } else {
            // User is not logged in, go to login page
            window.location.href = '/login?next=/buy';
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function () {
        loadBuyRate();
        if (window.lucide && lucide.createIcons) lucide.createIcons();
    });
</script>
{% endblock %}