{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="WestLinks Exchange - Fast, secure P2P cryptocurrency trading platform. Buy and sell USDT with Ghana Cedis instantly." />
  <meta name="keywords" content="crypto, P2P, USDT, Ghana, mobile money, trading, WestLinks" />
  <meta name="theme-color" content="#0a0e27" />
  <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
  <title>{% block title %}WestLinks Exchange - P2P Crypto Trading{% endblock %}</title>

  <!-- Stylesheets -->
  <link rel="stylesheet" href="{% static 'css/app.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  {% block extra_head %}{% endblock %}
</head>

<body>
  <!-- Header -->
  <header class="cvp-header">
    <div class="cvp-header-inner">
      <!-- Logo -->
      <a href="/" class="cvp-brand">
        <img src="{% static 'images/logo.jpg' %}" alt="WestLinks Exchange" style="height: 36px; width: auto;">
        <span style="margin-left: 0.75rem;">WestLinks Exchange</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="cvp-nav" id="desktopNav">
        <a href="/" class="cvp-link">Home</a>
        <a href="/about" class="cvp-link">About</a>
        <a href="/buy-crypto" class="cvp-link">Buy</a>
        <a href="/sell-crypto" class="cvp-link">Sell</a>
        <a href="#" class="cvp-link">Support</a>
        <a href="/dashboard" class="cvp-link" id="navWallet" style="display:none;">
          <i data-lucide="wallet" style="width: 18px; height: 18px;"></i>
          Dashboard
        </a>
        <a href="/profile" class="cvp-link" id="navProfile" style="display:none;">
          <i data-lucide="user" style="width: 18px; height: 18px;"></i>
          <span id="navProfileName">Profile</span>
        </a>
        <a href="/login" class="cvp-link" id="navLogin">Login</a>
        <a href="/register" class="cvp-link cvp-cta" id="navSignup">Get Started</a>
        <button onclick="logout()" class="cvp-link" id="navLogout"
          style="display:none; background:none; border:none; cursor:pointer; color:#ef4444;">
          <i data-lucide="log-out" style="width: 18px; height: 18px;"></i>
          Logout
        </button>
      </nav>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
        <i data-lucide="menu" style="width: 24px; height: 24px;"></i>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobileNav">
      <a href="/" class="mobile-nav-link">
        <i data-lucide="home"></i>
        <span>Home</span>
      </a>
      <a href="/about" class="mobile-nav-link">
        <i data-lucide="info"></i>
        <span>About</span>
      </a>
      <a href="/buy-crypto" class="mobile-nav-link">
        <i data-lucide="shopping-cart"></i>
        <span>Buy</span>
      </a>
      <a href="/sell-crypto" class="mobile-nav-link">
        <i data-lucide="banknote"></i>
        <span>Sell</span>
      </a>
      <a href="#" class="mobile-nav-link">
        <i data-lucide="headphones"></i>
        <span>Support</span>
      </a>
      <a href="/dashboard" class="mobile-nav-link" id="mobileNavWallet" style="display:none;">
        <i data-lucide="wallet"></i>
        <span>Dashboard</span>
      </a>
      <a href="/profile" class="mobile-nav-link" id="mobileNavProfile" style="display:none;">
        <i data-lucide="user"></i>
        <span>Profile</span>
      </a>
      <a href="/login" class="mobile-nav-link" id="mobileNavLogin">
        <i data-lucide="log-in"></i>
        <span>Login</span>
      </a>
      <a href="/register" class="mobile-nav-link" id="mobileNavSignup">
        <i data-lucide="user-plus"></i>
        <span>Get Started</span>
      </a>
      <button onclick="logout()" class="mobile-nav-link" id="mobileNavLogout"
        style="display:none; background:none; border:none; cursor:pointer; color:#ef4444; text-align:left;">
        <i data-lucide="log-out"></i>
        <span>Logout</span>
      </button>
    </nav>
  </header>

  <!-- Main Content -->
  <main>
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="cvp-footer">
    <div class="cvp-container">
      <div class="footer-content">
        <div class="footer-section">
          <div class="cvp-brand" style="margin-bottom: 1rem;">
            <img src="{% static 'images/logo.jpg' %}" alt="WestLinks Exchange" style="height: 36px; width: auto;">
            <span style="margin-left: 0.75rem;">WestLinks Exchange</span>
          </div>
          <p class="text-secondary" style="margin-bottom: 1rem;">Fast, secure P2P cryptocurrency trading platform built
            for West Africa.</p>
          <div class="footer-social">
            <a href="#" aria-label="Twitter">
              <i data-lucide="twitter"></i>
            </a>
            <a href="#" aria-label="Telegram">
              <i data-lucide="send"></i>
            </a>
            <a href="#" aria-label="Discord">
              <i data-lucide="message-circle"></i>
            </a>
          </div>
        </div>

        <div class="footer-section">
          <h4>Products</h4>
          <a href="/buy">Buy Crypto</a>
          <a href="/sell">Sell Crypto</a>
          <a href="/dashboard">Dashboard</a>
          <a href="/profile">Profile</a>
        </div>

        <div class="footer-section">
          <h4>Support</h4>
          <a href="#">Help Center</a>
          <a href="#">Contact Us</a>
          <a href="#">FAQ</a>
          <a href="#">API Docs</a>
        </div>

        <div class="footer-section">
          <h4>Legal</h4>
          <a href="#">Terms of Service</a>
          <a href="#">Privacy Policy</a>
          <a href="#">Cookie Policy</a>
          <a href="#">AML Policy</a>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 WestLinks Exchange. All rights reserved.</p>
        <p class="text-muted" style="font-size: 0.75rem;">Trade responsibly. Cryptocurrency trading involves risk.</p>
      </div>
    </div>
  </footer>

  <!-- Global Scripts -->
  <script>
    const API_URL = window.location.origin + '/api';

    // Initialize Lucide Icons
    function initIcons() {
      if (window.lucide && lucide.createIcons) {
        lucide.createIcons();
      }
    }

    // Mobile Menu Toggle
    // Mobile Menu Toggle - Robust Event Delegation Version
    function initMobileMenu() {
      // Prevent multiple attachments
      if (window.mobileMenuInitialized) return;
      window.mobileMenuInitialized = true;

      console.log('Initializing Mobile Menu (Robust Version)...');

      // Use event delegation on document body
      document.body.addEventListener('click', function (e) {
        // Find the toggle button (could be the target or a parent)
        const toggleBtn = e.target.closest('#mobileMenuToggle');

        if (toggleBtn) {
          console.log('Hamburger clicked via delegation!');
          e.preventDefault();
          e.stopPropagation();

          const mobileNav = document.getElementById('mobileNav');
          if (mobileNav) {
            mobileNav.classList.toggle('active');
            console.log('Menu toggled. Active:', mobileNav.classList.contains('active'));

            // Update Icon
            const icon = toggleBtn.querySelector('[data-lucide]');
            if (icon) {
              const currentIcon = icon.getAttribute('data-lucide');
              icon.setAttribute('data-lucide', currentIcon === 'menu' ? 'x' : 'menu');
              if (window.lucide && lucide.createIcons) {
                lucide.createIcons();
              }
            }
          }
        }
      });

      // Close menu when clicking outside
      document.addEventListener('click', function (e) {
        const mobileNav = document.getElementById('mobileNav');
        const toggleBtn = document.getElementById('mobileMenuToggle');

        if (mobileNav && mobileNav.classList.contains('active')) {
          // If click is NOT on nav AND NOT on toggle
          if (!mobileNav.contains(e.target) && (!toggleBtn || !toggleBtn.contains(e.target))) {
            mobileNav.classList.remove('active');

            // Reset icon
            if (toggleBtn) {
              const icon = toggleBtn.querySelector('[data-lucide]');
              if (icon) {
                icon.setAttribute('data-lucide', 'menu');
                if (window.lucide && lucide.createIcons) {
                  lucide.createIcons();
                }
              }
            }
          }
        }
      });

      // Close when clicking links
      document.addEventListener('click', function (e) {
        if (e.target.closest('.mobile-nav-link')) {
          const mobileNav = document.getElementById('mobileNav');
          const toggleBtn = document.getElementById('mobileMenuToggle');

          if (mobileNav) {
            mobileNav.classList.remove('active');

            if (toggleBtn) {
              const icon = toggleBtn.querySelector('[data-lucide]');
              if (icon) {
                icon.setAttribute('data-lucide', 'menu');
                if (window.lucide && lucide.createIcons) {
                  lucide.createIcons();
                }
              }
            }
          }
        }
      });
    }

    // Initialize Navigation Authentication
    function initNavAuth() {
      const tokenRaw = localStorage.getItem('coinvibe_token');
      let user = null;
      try {
        user = JSON.parse(localStorage.getItem('coinvibe_user') || 'null');
      } catch (_) {
        user = null;
      }

      const tokenValid = !!(tokenRaw && tokenRaw !== 'null' && tokenRaw !== 'undefined' && tokenRaw !== '');
      const brandLink = document.querySelector('.cvp-header .cvp-brand');

      // Desktop Nav Elements
      const navProfile = document.getElementById('navProfile');
      const navProfileName = document.getElementById('navProfileName');
      const navLogin = document.getElementById('navLogin');
      const navSignup = document.getElementById('navSignup');
      const navWallet = document.getElementById('navWallet');
      const navLogout = document.getElementById('navLogout');

      // Mobile Nav Elements
      const mobileNavProfile = document.getElementById('mobileNavProfile');
      const mobileNavLogin = document.getElementById('mobileNavLogin');
      const mobileNavSignup = document.getElementById('mobileNavSignup');
      const mobileNavWallet = document.getElementById('mobileNavWallet');
      const mobileNavLogout = document.getElementById('mobileNavLogout');

      if (tokenValid) {
        // Show authenticated elements
        const firstName = (user && user.name) ? user.name.split(' ')[0] : (user && user.username) ? user.username : 'User';

        if (navProfile) {
          navProfile.style.display = 'flex';
          if (navProfileName) navProfileName.textContent = firstName;
        }
        if (navWallet) navWallet.style.display = 'flex';
        if (navLogout) navLogout.style.display = 'flex';
        if (navLogin) navLogin.style.display = 'none';
        if (navSignup) navSignup.style.display = 'none';

        if (mobileNavProfile) mobileNavProfile.style.display = 'flex';
        if (mobileNavWallet) mobileNavWallet.style.display = 'flex';
        if (mobileNavLogout) mobileNavLogout.style.display = 'flex';
        if (mobileNavLogin) mobileNavLogin.style.display = 'none';
        if (mobileNavSignup) mobileNavSignup.style.display = 'none';
        if (brandLink) brandLink.setAttribute('href', '/dashboard');
      } else {
        // Show unauthenticated elements
        if (navProfile) navProfile.style.display = 'none';
        if (navWallet) navWallet.style.display = 'none';
        if (navLogout) navLogout.style.display = 'none';
        if (navLogin) navLogin.style.display = 'flex';
        if (navSignup) navSignup.style.display = 'flex';

        if (mobileNavProfile) mobileNavProfile.style.display = 'none';
        if (mobileNavWallet) mobileNavWallet.style.display = 'none';
        if (mobileNavLogout) mobileNavLogout.style.display = 'none';
        if (mobileNavLogin) mobileNavLogin.style.display = 'flex';
        if (mobileNavSignup) mobileNavSignup.style.display = 'flex';
        if (brandLink) brandLink.setAttribute('href', '/');
      }
    }

    // Logout Function
    function logout() {
      localStorage.removeItem('coinvibe_token');
      localStorage.removeItem('coinvibe_user');
      window.location.href = '/';
    }

    // Initialize on DOM Ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function () {
        initIcons();
        initNavAuth();
        initMobileMenu();
      });
    } else {
      initIcons();
      initNavAuth();
      initMobileMenu();
    }
  </script>

  {% block extra_scripts %}{% endblock %}
  <!-- WhatsApp Floating Button -->
  <style>
    .whatsapp-float {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: #25d366;
      color: #fff;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      text-align: center;
      font-size: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .whatsapp-float:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(37, 211, 102, 0.4);
      background-color: #20bd5a;
    }

    .whatsapp-float svg {
      width: 32px;
      height: 32px;
      fill: currentColor;
    }

    @media (max-width: 768px) {
      .whatsapp-float {
        width: 50px;
        height: 50px;
        bottom: 20px;
        right: 20px;
      }

      .whatsapp-float svg {
        width: 28px;
        height: 28px;
      }
    }
  </style>
  <a href="https://wa.me/233575035893" class="whatsapp-float" target="_blank" rel="noopener noreferrer"
    aria-label="Chat on WhatsApp">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
      <!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
      <path
        d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-4-10.5-6.7z" />
    </svg>
  </a>
</body>

</html>