{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile Settings â€¢ WestLinks Exchange</title>
  <link rel="stylesheet" href="{% static 'css/app.css' %}">
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="{% static 'js/profile.js' %}"></script>
</head>

<body>
  <!-- Authentication Check -->
  <script>
    (function () {
      const token = localStorage.getItem('coinvibe_token');
      if (!token || token === 'null' || token === 'undefined' || token === '') {
        window.location.href = '/login?next=/profile';
      }
    })();
  </script>
  <header class="cvp-header">
    <div class="cvp-header-inner">
      <a href="/" class="cvp-brand">
        <img src="{% static 'images/logo.jpg' %}" alt="WestLinks Exchange" style="height: 36px; width: auto;">
        <span style="margin-left: 0.75rem;">WestLinks Exchange</span>
      </a>

      <!-- Mobile Hamburger Menu Button -->
      <button class="mobile-nav-toggle" onclick="toggleSidebar()" aria-label="Toggle navigation">
        <i data-lucide="menu" style="width: 24px; height: 24px;"></i>
      </button>
      <nav class="cvp-nav">
        <a href="/dashboard" class="cvp-link">Dashboard</a>
        <a href="/profile" class="cvp-link">Profile</a>
        <div id="dashUserMenu" style="display:flex; align-items:center; gap:.5rem; margin-left:1rem;">
          <div id="dashAvatar"
            style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg, var(--highlight-yellow), var(--highlight-cyan));color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.875rem;">
            U</div>
          <span id="dashUserName" class="text-primary" style="font-weight:600;"></span>
          <button onclick="logout()" class="cvp-link"
            style="color:#ef4444; background:none; border:none; cursor:pointer;">Logout</button>
        </div>
      </nav>
    </div>
  </header>

  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="dashboard-sidebar" id="dashboardSidebar">
      <nav class="sidebar-nav">
        <div class="sidebar-section">
          <div class="sidebar-section-title">Main Menu</div>
          <a href="/dashboard" class="sidebar-link">
            <i data-lucide="layout-dashboard"></i>
            <span>Overview</span>
          </a>
          <a href="/buy" class="sidebar-link">
            <i data-lucide="link"></i>
            <span>Payment Links</span>
          </a>
          <a href="/sell" class="sidebar-link">
            <i data-lucide="coins"></i>
            <span>Sell Crypto</span>
          </a>
          <a href="#" class="sidebar-link">
            <i data-lucide="receipt"></i>
            <span>Transactions</span>
          </a>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Settings</div>
          <a href="/profile" class="sidebar-link active">
            <i data-lucide="user"></i>
            <span>Profile</span>
          </a>
          <a href="/payment-methods" class="sidebar-link">
            <i data-lucide="credit-card"></i>
            <span>Payment Methods</span>
          </a>
          <a href="#" class="sidebar-link">
            <i data-lucide="refresh-cw"></i>
            <span>Refresh Rates</span>
          </a>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Account</div>
          <a href="#" class="sidebar-link" onclick="logout(); return false;">
            <i data-lucide="log-out"></i>
            <span>Logout</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
      <!-- Profile Header -->
      <div class="profile-header">
        <div class="profile-avatar-large" id="profileAvatarLarge">
          U
          <div class="profile-avatar-edit" onclick="alert('Avatar upload coming soon!')">
            <i data-lucide="camera" style="width: 18px; height: 18px;"></i>
          </div>
        </div>
        <div class="profile-info">
          <h1 class="profile-name" id="profileName">User Name</h1>
          <p class="profile-email" id="profileEmail">user@example.com</p>
          <div class="profile-badges">
            <span class="badge badge-success">
              <i data-lucide="check-circle" style="width: 12px; height: 12px; margin-right: 4px;"></i>
              Verified
            </span>
            <span class="badge badge-info">
              <i data-lucide="shield" style="width: 12px; height: 12px; margin-right: 4px;"></i>
              Vendor
            </span>
          </div>
        </div>
      </div>

      <!-- Personal Information -->
      <div class="settings-section">
        <h2 class="settings-section-title">Personal Information</h2>
        <form id="personalInfoForm" onsubmit="updatePersonalInfo(event)">
          <div class="settings-form-row">
            <div class="settings-form-group">
              <label for="fullName">Full Name</label>
              <input type="text" id="fullName" class="field" placeholder="Enter your full name" required />
            </div>
            <div class="settings-form-group">
              <label for="username">Username</label>
              <input type="text" id="username" class="field" placeholder="Enter username" required />
            </div>
          </div>

          <div class="settings-form-row">
            <div class="settings-form-group">
              <label for="email">Email Address</label>
              <input type="email" id="email" class="field" placeholder="your@email.com" required readonly
                style="background: var(--bg-secondary); cursor: not-allowed;" />
              <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.25rem;">Email cannot be changed</p>
            </div>
            <div class="settings-form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" class="field" placeholder="+233 24 123 4567" />
            </div>
          </div>

          <div class="settings-form-group">
            <label for="bio">Bio (Optional)</label>
            <textarea id="bio" class="field" rows="3" placeholder="Tell us about yourself..."></textarea>
          </div>

          <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end;">
            <button type="button" onclick="resetPersonalInfo()" class="btn btn-secondary">
              <i data-lucide="x" style="width: 18px; height: 18px;"></i>
              Reset
            </button>
            <button type="submit" class="btn btn-primary">
              <i data-lucide="save" style="width: 18px; height: 18px;"></i>
              Save Changes
            </button>
          </div>
        </form>
      </div>

      <!-- Payment Settings -->
      <div class="settings-section">
        <h2 class="settings-section-title">Payment Settings</h2>
        <form id="paymentSettingsForm" onsubmit="updatePaymentSettings(event)">
          <div class="settings-form-row">
            <div class="settings-form-group">
              <label for="momoNumber">Mobile Money Number</label>
              <input type="tel" id="momoNumber" class="field" placeholder="0244123456" pattern="0\d{9}" maxlength="10"
                title="Ghana phone numbers must be exactly 10 digits starting with 0" />
              <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.25rem;">10 digits starting with 0</p>
            </div>
            <div class="settings-form-group">
              <label for="momoProvider">MoMo Provider</label>
              <select id="momoProvider" class="field">
                <option value="">Select Provider</option>
                <option value="MTN">MTN Mobile Money</option>
                <option value="Vodafone">Vodafone Cash</option>
                <option value="AirtelTigo">AirtelTigo Money</option>
              </select>
            </div>
          </div>

          <div class="settings-form-group">
            <label for="walletAddress">USDT Wallet Address (Optional)</label>
            <input type="text" id="walletAddress" class="field" placeholder="Your TRC20/ERC20 wallet address" />
            <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.25rem;">Your personal wallet for receiving
              payments</p>
          </div>

          <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end;">
            <button type="button" onclick="resetPaymentSettings()" class="btn btn-secondary">
              <i data-lucide="x" style="width: 18px; height: 18px;"></i>
              Reset
            </button>
            <button type="submit" class="btn btn-primary">
              <i data-lucide="save" style="width: 18px; height: 18px;"></i>
              Save Changes
            </button>
          </div>
        </form>
      </div>

      <!-- Security Settings -->
      <div class="settings-section">
        <h2 class="settings-section-title">Security Settings</h2>
        <form id="securityForm" onsubmit="updatePassword(event)">
          <div class="settings-form-group">
            <label for="currentPassword">Current Password</label>
            <input type="password" id="currentPassword" class="field" placeholder="Enter current password" />
          </div>

          <div class="settings-form-row">
            <div class="settings-form-group">
              <label for="newPassword">New Password</label>
              <input type="password" id="newPassword" class="field" placeholder="Enter new password" minlength="8" />
              <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.25rem;">Minimum 8 characters</p>
            </div>
            <div class="settings-form-group">
              <label for="confirmPassword">Confirm New Password</label>
              <input type="password" id="confirmPassword" class="field" placeholder="Confirm new password"
                minlength="8" />
            </div>
          </div>

          <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end;">
            <button type="button" onclick="resetSecurityForm()" class="btn btn-secondary">
              <i data-lucide="x" style="width: 18px; height: 18px;"></i>
              Reset
            </button>
            <button type="submit" class="btn btn-primary">
              <i data-lucide="lock" style="width: 18px; height: 18px;"></i>
              Update Password
            </button>
          </div>
        </form>
      </div>

      <!-- Notification Preferences -->
      <div class="settings-section">
        <h2 class="settings-section-title">Notification Preferences</h2>
        <form id="notificationForm" onsubmit="updateNotifications(event)">
          <div class="settings-form-group">
            <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
              <input type="checkbox" id="emailNotifications" checked
                style="width: 20px; height: 20px; cursor: pointer;" />
              <div>
                <div style="font-weight: 600; color: var(--text-primary);">Email Notifications</div>
                <div class="text-muted" style="font-size: 0.75rem;">Receive email updates about your transactions</div>
              </div>
            </label>
          </div>

          <div class="settings-form-group">
            <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
              <input type="checkbox" id="paymentAlerts" checked style="width: 20px; height: 20px; cursor: pointer;" />
              <div>
                <div style="font-weight: 600; color: var(--text-primary);">Payment Alerts</div>
                <div class="text-muted" style="font-size: 0.75rem;">Get notified when you receive payments</div>
              </div>
            </label>
          </div>

          <div class="settings-form-group">
            <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
              <input type="checkbox" id="marketingEmails" style="width: 20px; height: 20px; cursor: pointer;" />
              <div>
                <div style="font-weight: 600; color: var(--text-primary);">Marketing Emails</div>
                <div class="text-muted" style="font-size: 0.75rem;">Receive updates about new features and promotions
                </div>
              </div>
            </label>
          </div>

          <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end; margin-top: var(--spacing-md);">
            <button type="submit" class="btn btn-primary">
              <i data-lucide="save" style="width: 18px; height: 18px;"></i>
              Save Preferences
            </button>
          </div>
        </form>
      </div>

      <!-- Danger Zone -->
      <div class="settings-section" style="border-color: rgba(239, 68, 68, 0.3);">
        <h2 class="settings-section-title" style="color: #ef4444;">Danger Zone</h2>
        <div
          style="padding: var(--spacing-md); background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px;">
          <div
            style="display: flex; justify-content: space-between; align-items: center; gap: var(--spacing-md); flex-wrap: wrap;">
            <div>
              <h4 style="color: #ef4444; margin-bottom: 0.5rem; font-size: var(--font-size-base); font-weight: 600;">
                Delete Account</h4>
              <p class="text-muted" style="font-size: 0.875rem; margin: 0;">Permanently delete your account and all
                associated data. This action cannot be undone.</p>
            </div>
            <button onclick="confirmDeleteAccount()" class="btn"
              style="background: #ef4444; color: white; flex-shrink: 0;">
              <i data-lucide="trash-2" style="width: 18px; height: 18px;"></i>
              Delete Account
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Mobile Sidebar Toggle -->
  <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
    <i data-lucide="menu" style="width: 24px; height: 24px;"></i>
  </button>

  <!-- Success Toast -->
  <div id="successToast"
    style="display: none; position: fixed; bottom: var(--spacing-lg); right: var(--spacing-lg); background: var(--bg-card); border: 1px solid var(--highlight-green); border-radius: 12px; padding: var(--spacing-md); box-shadow: var(--shadow-lg), var(--glow-green); z-index: 2000; min-width: 300px;">
    <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
      <i data-lucide="check-circle" style="width: 24px; height: 24px; color: var(--highlight-green);"></i>
      <div>
        <div style="font-weight: 600; color: var(--text-primary);">Success!</div>
        <div class="text-secondary" style="font-size: 0.875rem;" id="successMessage">Changes saved successfully</div>
      </div>
    </div>
  </div>


</body>

</html>